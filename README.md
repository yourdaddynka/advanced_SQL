# Анализ и статистика данных в БД.

![Info21 v1.0](./DBimage/SQL.png)

## Part 1. Создание базы данных

1. Создание базы данных и таблиц, описанных выше, с наполнением данными. Также внесение процедур для импорта и экспорта данных из таблиц с использованием csv файлов.

2. Создание скрипта, который добавляет новую P2P проверку в базу данных. При указании статуса "начало", создание новой записи в таблице Checks. Добавление данных в таблицу P2P.

3.  Написание процедуры для добавления проверки Verter'ом. При указании статуса "начало", связывание новой записи с последней успешной P2P проверкой.

4.  Создание триггеров: после добавления новой записи в таблицу P2P, обновление количества переданных пир поинтов; перед добавлением новой записи в таблицу XP, проверка корректности добавляемой записи.

## Part 2. Изменение данных

1. Создание процедур и триггеров для добавления P2P и Verter проверок, а также корректной обработки XP записей в базе данных. Обработка всех краевых случаев добавления записи.

## Part 3. Получение данных

Написание функций для удобного вывода данных о переданных пир поинтах, полученных XP и посещениях, а также для выявления изменений в количестве поинтов у пиров.
Создание запросов для определения удачных дней для проверок, анализа рекомендаций пиров и вычисления процента успешность/неуспешность пиров в свой день рождения.

1. Функция возвращает таблицу с информацией о передаче пир поинтов между пирами.

2. Функция возвращает таблицу с информацией о пользователях, успешно прошедших проверку задания.

 3. Функция определяет пиров, не покидавших кампус в течение определенного дня.

 4. Процедура считает изменение в количестве пир поинтов каждого пира.

 5. Процедура считает изменение в количестве пир поинтов каждого пира, используя данные из первой функции.

 6. Процедура определяет самое часто проверяемое задание за каждый день.

 7. Процедура находит пиров, которые завершили заданный блок задач.

 8. Процедура определяет, к какому пиру стоит идти на проверку каждому обучающемуся.

 9. Процедура определяет процент пиров, приступивших к разным блокам заданий.

 10. Процедура определяет процент пиров, успешно или неуспешно проходивших проверку в свой день рождения.

 11. Процедура находит пиров, сдавших определенные задания, но не сдавших другое.

 12. Рекурсивное обобщенное табличное выражение для вывода количества предшествующих задач к каждой задаче.

 13. Процедура находит "удачные" для проверок дни с заданным количеством идущих подряд успешных проверок.

 14. Процедура определяет пира с наибольшим количеством XP.

 15. Процедура находит пиров, приходивших раньше заданного времени несколько раз.

 16. Процедура находит пиров, выходивших из кампуса больше заданного числа раз за последние N дней.

 17. Процедура определяет процент ранних входов в кампус для каждого месяца по данным о входах пользователей.

## Part 4. Метаданные

Для данной части задания вам нужно создана отдельная база данных, в которой создаются таблицы, функции, процедуры и триггеры, необходимые для тестирования процедур.

Создание и заполнение этой базы данных, а также написанные процедуры, внести в файл *part4.sql*.

1. Создание хранимой процедуры, которая, не уничтожая базу данных, уничтожает все те таблицы текущей базы данных, имена которых начинаются с фразы 'TableName'.

2. Создание хранимой процедуры с выходным параметром, которая выводит список имен и параметров всех скалярных SQL функций пользователя в текущей базе данных. Имена функций без параметров не выводить. Имена и список параметров должны выводиться в одну строку. Выходной параметр возвращает количество найденных функций.

3. Создание хранимой процедуры с выходным параметром, которая уничтожает все SQL DML триггеры в текущей базе данных. Выходной параметр возвращает количество уничтоженных триггеров.

4. Создание хранимой процедуры с входным параметром, которая выводит имена и описания типа объектов (только хранимых процедур и скалярных функций), в тексте которых на языке SQL встречается строка, задаваемая параметром процедуры.

